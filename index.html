<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>KUIS BAHASA JEPANG RAMA</title>
<style>
  html, body { margin: 0; padding: 0; background-color: #121212; color: #eee; font-family: sans-serif; }
  body { display: flex; justify-content: center; min-height: 100vh; overflow-x: hidden; }
  #app { width: 100vw; max-width: 420px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; position: relative; }
  
  #backBtn { position: absolute; top: 15px; left: 15px; font-size: 28px; background: none; border: none; color: #ff5722; cursor: pointer; display: none; z-index: 1000; padding: 5px; line-height: 1; }
  
  #quizHeader { text-align: center; margin-bottom: 15px; }
  #quizInfo { font-size: 12px; color: #ff5722; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; border: 1px solid #ff5722; padding: 2px 8px; border-radius: 4px; display: inline-block; }
  #instruksi { font-size: 14px; color: #ffb74d; margin-top: 8px; font-style: italic; }

  .menu-container { display: none; flex-direction: column; gap: 15px; align-items: center; width: 100%; padding-top: 50px; }
  #headerGrid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
  
  .mainBtn { background: #ff5722; border-radius: 18px; padding: 18px; font-weight: bold; color: white; width: 95%; border: none; cursor: pointer; font-size: 15px; text-transform: uppercase; box-shadow: 0 4px 0 #bf360c; transition: 0.1s; }
  .mainBtn:active { transform: translateY(2px); box-shadow: 0 2px 0 #bf360c; }
  
  .iroBtn { background: #2196f3; box-shadow: 0 4px 0 #1565c0; }
  .babBtn { background: #1e1e1e; border-radius: 12px; padding: 10px; color: #eee; border: 1px solid #333; cursor: pointer; min-width: 85px; font-size: 13px; }

  #wordBox { display: none; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; text-align: center; }
  #kanji { font-size: 20px; color: #888; margin-bottom: 5px; min-height: 24px; }
  #kana { font-size: 34px; color: #ff5722; font-weight: bold; padding: 0 10px; }
  
  #options { display: none; flex-direction: column; gap: 12px; width: 100%; margin-bottom: 40px; margin-top: 20px; }
  .optBtn { background: #252525; border: 1px solid #333; padding: 18px; border-radius: 15px; color: white; font-size: 18px; cursor: pointer; text-align: center; transition: 0.2s; }
  .optBtn.correct { background: #4caf50 !important; }
  .optBtn.wrong { background: #f44336 !important; }

  /* Style Baru untuk Mode Ketik */
  #inputContainer { display: none; width: 100%; flex-direction: column; gap: 12px; margin-top: 20px; margin-bottom: 40px;}
  #userAnswer { width: 100%; padding: 18px; border-radius: 15px; border: 2px solid #333; background: #252525; color: white; font-size: 18px; text-align: center; box-sizing: border-box; }
  #userAnswer:focus { border-color: #ff5722; outline: none; }
  #wrongMessage { display: none; color: #ffb74d; font-size: 14px; font-weight: bold; text-align: center; background: rgba(244, 67, 54, 0.1); padding: 10px; border-radius: 8px; border: 1px solid #f44336; }

  #resultPage { display: none; text-align: center; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; }
  .score-circle { width: 140px; height: 140px; border-radius: 50%; border: 6px solid #ff5722; display: flex; justify-content: center; align-items: center; margin: 0 auto 20px auto; font-size: 35px; font-weight: bold; color: #ff5722;}
</style>
</head>
<body>

<div id="app">
  <button id="backBtn" onclick="goBack()">‚Üê</button>

  <div id="mainMenu" class="menu-container">
    <h2 style="color: #ff5722;">Êó•Êú¨Ë™û„ÇØ„Ç§„Ç∫</h2>
    <button class="mainBtn" onclick="showMinnaMenu()">MINNA NO NIHONGO</button>
    <button class="mainBtn iroBtn" onclick="showIrodoriMenu()">IRODORI</button>

    <div style="margin-top: 40px; padding: 20px 0; text-align: center; border-top: 1px solid #222; width: 100%;">
        <p style="font-size: 12px; color: #555; line-height: 1.6; margin: 0;">
            Copyright ¬© 2026<br>
            Pengembang Cahya Ramadhan <br>
            Â§¢„ÅÆÈÅì„ÇØ„É©„Çπ
        </p>
    </div>
  </div>

  <div id="minnaMenu" class="menu-container">
    <button class="mainBtn" onclick="showBagian(1)">KOTOBA BAGIAN 1 (BAB 1-25)</button>
    <button class="mainBtn" onclick="showBagian(2)">KOTOBA BAGIAN 2 (BAB 26-50)</button>
    <button class="mainBtn" style="background:#333; border:2px solid #ff5722;" onclick="showRefMenu()">KOSAKATA REFERENSI</button>
  </div>

  <div id="irodoriMenu" class="menu-container">
    <h2 style="color:#2196f3;">IRODORI</h2>
    <button class="mainBtn iroBtn" onclick="startIrodoriKanji()">KANJI</button>
  </div>

  <div id="dynamicMenu" class="menu-container">
    <h2 id="dynamicTitle">Pilih Bab</h2>
    <div id="headerGrid"></div>
  </div>

  <div id="modeMenu" class="menu-container">
    <h2 style="color: #ffb74d;">Pilih Mode Kuis</h2>
    <p id="modeInfo" style="margin-top:-10px; color:#888;"></p>
    <button class="mainBtn" onclick="setQuizMode('jp-id')">JEPANG ‚ûî INDO</button>
    <button class="mainBtn iroBtn" onclick="setQuizMode('id-jp')">INDO ‚ûî JEPANG</button>
  </div>

  <div id="wordBox">
    <div id="quizHeader">
        <div id="quizInfo"></div>
        <div id="instruksi"></div>
    </div>
    <div id="kanji"></div>
    <div id="kana"></div>
  </div>

  <div id="comboSection" style="display:none; text-align:center; margin-bottom: 10px;">üå±‚îÇ <span id="flowerCount" style="font-weight:bold; color:#4caf50;">0</span></div>
  
  <div id="options"></div>

  <div id="inputContainer">
    <input type="text" id="userAnswer" placeholder="Ketik jawabannya..." autocomplete="off">
    <div id="wrongMessage"></div>
    <button class="mainBtn" style="margin-top: 10px; width: 100%; font-size: 14px; padding: 12px;" onclick="checkInputAnswer()">KIRIM JAWABAN</button>
  </div>

  <div id="resultPage">
    <div class="score-circle" id="finalScore">0%</div>
    <div id="finalDetail" style="margin-bottom:20px; color:#aaa; white-space: pre-line;"></div>
    <button id="nextChunkBtn" class="mainBtn" style="margin-bottom:10px; display:none;">LANJUT KUIS</button>
    <button class="mainBtn" style="background:#555;" onclick="goBack()">KEMBALI</button>
  </div>
</div>

<script src="data_minna.js"></script>
<script src="data_referensi.js"></script>
<script src="data_irodori.js"></script>

<script>
  let masterPool = [];
  let currentQuestions = [];
  let currentIndex = 0;
  let correctCount = 0;
  let combo = 0;
  let activeView = 'main';
  let currentLabel = '';
  let selectedData = null;
  let quizMode = 'jp-id';
  let currentAnswer = ""; 

  function hideAll() {
    ['mainMenu','minnaMenu','irodoriMenu','dynamicMenu','modeMenu','wordBox','options','comboSection','resultPage','inputContainer']
    .forEach(id => { 
        const el = document.getElementById(id);
        if(el) el.style.display = 'none'; 
    });
  }

  function showMainMenu() { hideAll(); document.getElementById('mainMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'none'; activeView = 'main'; }
  function showMinnaMenu() { hideAll(); document.getElementById('minnaMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'minna'; }
  function showIrodoriMenu() { hideAll(); document.getElementById('irodoriMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'irodori'; }

  function showGridMenu(title, type, start, end) {
    hideAll();
    const menu = document.getElementById('dynamicMenu');
    const grid = document.getElementById('headerGrid');
    document.getElementById('dynamicTitle').innerText = title;
    grid.innerHTML = '';
    menu.style.display = 'flex';
    document.getElementById('backBtn').style.display = 'block';
    activeView = type;

    for(let i=start; i<=end; i++) {
        let b = document.createElement('button');
        b.className = 'babBtn';
        b.innerText = 'Bab ' + i;
        b.onclick = () => {
            selectedData = type === 'ref' ? referensiData[i] : babData[i];
            currentLabel = (type === 'ref' ? 'Ref Bab ' : 'Bab ') + i;
            showModeMenu();
        };
        grid.appendChild(b);
    }
  }

  function showBagian(n) { showGridMenu("Minna No Nihongo", 'bagian_'+n, n === 1 ? 1 : 26, n === 1 ? 25 : 50); }
  function showRefMenu() { showGridMenu("Kosakata Referensi", "ref", 1, 50); }

  function showModeMenu() {
    hideAll();
    document.getElementById('modeMenu').style.display = 'flex';
    document.getElementById('modeInfo').innerText = currentLabel;
    document.getElementById('backBtn').style.display = 'block';
    activeView = 'mode';
  }

  function setQuizMode(mode) {
    quizMode = mode;
    startQuiz(currentLabel, selectedData);
  }

  function startQuiz(label, data) {
    if(!data || data.length === 0) { alert("Data belum tersedia!"); return; }
    currentLabel = label;
    masterPool = [...data].sort(() => Math.random() - 0.5);
    nextChunk();
  }

  function startIrodoriKanji() {
    selectedData = irodoriKanjiData;
    currentLabel = "Kanji Irodori";
    showModeMenu();
  }

  function nextChunk() {
    currentQuestions = masterPool.splice(0, 10);
    currentIndex = 0; correctCount = 0; combo = 0;
    hideAll();
    document.getElementById('wordBox').style.display = 'flex'; 
    document.getElementById('comboSection').style.display = 'block';
    document.getElementById('backBtn').style.display = 'block';
    activeView = 'quiz';
    renderQuestion();
  }

  // Deteksi Enter untuk input
  document.getElementById('userAnswer').addEventListener('keypress', function (e) {
      if (e.key === 'Enter') checkInputAnswer();
  });

  function renderQuestion() {
    if(currentIndex >= currentQuestions.length) { showResult(); return; }
    const q = currentQuestions[currentIndex];
    const optBox = document.getElementById('options');
    const inputCont = document.getElementById('inputContainer');
    const inputField = document.getElementById('userAnswer');
    const msg = document.getElementById('wrongMessage');

    document.getElementById('quizInfo').innerText = currentLabel + (quizMode === 'jp-id' ? " (JP-ID)" : " (ID-JP)");
    document.getElementById('instruksi').innerText = q.instruksi || "Pilih/Ketik jawaban yang benar";
    
    inputField.value = "";
    inputField.style.borderColor = "#333";
    msg.style.display = "none";
    optBox.innerHTML = '';
    
    let choices = [];
    if (quizMode === 'jp-id') {
        document.getElementById('kanji').innerText = q.kanji || "";
        document.getElementById('kana').innerText = q.kana || "";
        currentAnswer = q.correct;
        choices = [...q.answers]; 
    } else {
        document.getElementById('kanji').innerText = q.kanji || ""; 
        document.getElementById('kana').innerText = q.correct; 
        currentAnswer = q.kana;
        choices.push(q.kana);
        let otherPool = selectedData.filter(item => item.kana !== q.kana);
        let randomChoices = otherPool.sort(() => Math.random() - 0.5).slice(0, 3);
        randomChoices.forEach(item => choices.push(item.kana));
    }

    // RANDOM MODE: Tentukan apakah ketik atau pilihan ganda
    const isTypingMode = Math.random() > 0.5;

    if (isTypingMode) {
        optBox.style.display = 'none';
        inputCont.style.display = 'flex';
        inputField.focus();
    } else {
        optBox.style.display = 'flex';
        inputCont.style.display = 'none';
        [...choices].sort(()=>Math.random()-0.5).forEach(txt => {
            let b = document.createElement('button'); 
            b.className = 'optBtn'; 
            b.innerText = txt;
            b.onclick = () => {
                if(txt === currentAnswer) processAnswer(true, b);
                else processAnswer(false, b);
            };
            optBox.appendChild(b);
        });
    }
    document.getElementById('flowerCount').innerText = combo;
  }

  function checkInputAnswer() {
      const q = currentQuestions[currentIndex];
      const userVal = document.getElementById('userAnswer').value.trim();
      const inputField = document.getElementById('userAnswer');
      const msg = document.getElementById('wrongMessage');
      
      let isCorrect = false;
      if (quizMode === 'jp-id') {
          isCorrect = userVal.toLowerCase() === q.correct.toLowerCase();
      } else {
          // Benar jika sama dengan Kanji atau Kana
          isCorrect = (userVal === q.kanji) || (userVal === q.kana);
      }
      
      if(isCorrect) {
          inputField.style.borderColor = "#4caf50";
          processAnswer(true);
      } else {
          inputField.style.borderColor = "#f44336";
          msg.style.display = 'block';
          if (quizMode === 'jp-id') {
              msg.innerText = `Salah! Jawaban: ${q.correct}`;
          } else {
              msg.innerText = `Salah! Jawaban: ${q.kanji || ''} (${q.kana})`;
          }
          
          setTimeout(() => {
              processAnswer(false);
          }, 2500); 
      }
  }

  function processAnswer(isCorrect, element = null) {
      if(isCorrect) {
          if(element) element.classList.add('correct');
          correctCount++; combo++;
          setTimeout(() => {
              currentIndex++;
              renderQuestion();
          }, 700);
      } else {
          if(element) {
              element.classList.add('wrong');
              Array.from(document.getElementById('options').children).forEach(btn => {
                  if(btn.innerText === currentAnswer) btn.classList.add('correct');
              });
          }
          combo = 0;
          if(element) {
              setTimeout(() => {
                  currentIndex++;
                  renderQuestion();
              }, 1500);
          } else {
              // Jika dari mode ketik, langsung pindah (karena delay sudah ada di checkInputAnswer)
              currentIndex++;
              renderQuestion();
          }
      }
  }

  function showResult() {
    hideAll();
    document.getElementById('resultPage').style.display = 'flex';
    let p = Math.round((correctCount/currentQuestions.length)*100);
    document.getElementById('finalScore').innerText = p + "%";
    document.getElementById('finalDetail').innerText = `${currentLabel}\nSisa soal: ${masterPool.length}`;
    activeView = 'result';
    const btnLanjut = document.getElementById('nextChunkBtn');
    if (masterPool.length > 0) { btnLanjut.style.display = 'block'; btnLanjut.onclick = nextChunk; }
    else { btnLanjut.style.display = 'none'; }
  }

  function goBack() {
    if (activeView === 'quiz' || activeView === 'result') showModeMenu();
    else if (activeView === 'mode') {
        if(currentLabel.includes("Ref")) showRefMenu();
        else if(currentLabel.includes("Kanji")) showIrodoriMenu();
        else {
            let num = parseInt(currentLabel.replace("Bab ",""));
            showBagian(num <= 25 ? 1 : 2);
        }
    } else if (activeView.startsWith('bagian') || activeView === 'ref') showMinnaMenu();
    else if (activeView === 'minna' || activeView === 'irodori') showMainMenu();
    else showMainMenu();
  }

  window.onload = showMainMenu;
</script>
</body>
</html>
