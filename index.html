<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Kuis Jepang Rama</title>
<style>
  html, body { margin: 0; padding: 0; background-color: #121212; color: #eee; font-family: sans-serif; }
  body { display: flex; justify-content: center; min-height: 100vh; overflow-x: hidden; }
  #app { width: 100vw; max-width: 420px; padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; position: relative; }
  
  #backBtn { position: absolute; top: 15px; left: 15px; font-size: 28px; background: none; border: none; color: #ff5722; cursor: pointer; display: none; z-index: 1000; padding: 5px; line-height: 1; }
  
  #quizHeader { text-align: center; margin-bottom: 15px; }
  #quizInfo { font-size: 12px; color: #ff5722; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; border: 1px solid #ff5722; padding: 2px 8px; border-radius: 4px; display: inline-block; }
  #instruksi { font-size: 14px; color: #ffb74d; margin-top: 8px; font-style: italic; }

  .menu-container { display: none; flex-direction: column; gap: 15px; align-items: center; width: 100%; padding-top: 50px; }
  #headerGrid { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 20px; }
  
  .mainBtn { background: #ff5722; border-radius: 18px; padding: 18px; font-weight: bold; color: white; width: 95%; border: none; cursor: pointer; font-size: 15px; text-transform: uppercase; box-shadow: 0 4px 0 #bf360c; transition: 0.1s; }
  .mainBtn:active { transform: translateY(2px); box-shadow: 0 2px 0 #bf360c; }
  
  .iroBtn { background: #2196f3; box-shadow: 0 4px 0 #1565c0; }
  .babBtn { background: #1e1e1e; border-radius: 12px; padding: 10px; color: #eee; border: 1px solid #333; cursor: pointer; min-width: 85px; font-size: 13px; }

  #wordBox { display: none; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; text-align: center; }
  #kanji { font-size: 20px; color: #888; margin-bottom: 5px; }
  #kana { font-size: 34px; color: #ff5722; font-weight: bold; padding: 0 10px; }
  
  #options { display: none; flex-direction: column; gap: 12px; width: 100%; margin-bottom: 40px; margin-top: 20px; }
  .optBtn { background: #252525; border: 1px solid #333; padding: 18px; border-radius: 15px; color: white; font-size: 18px; cursor: pointer; text-align: center; transition: 0.2s; }
  .optBtn.correct { background: #4caf50 !important; }
  .optBtn.wrong { background: #f44336 !important; }

  #resultPage { display: none; text-align: center; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1; }
  .score-circle { width: 140px; height: 140px; border-radius: 50%; border: 6px solid #ff5722; display: flex; justify-content: center; align-items: center; margin: 0 auto 20px auto; font-size: 35px; font-weight: bold; color: #ff5722;}
</style>
</head>
<body>

<div id="app">
  <button id="backBtn" onclick="goBack()">⬅️</button>

    <div id="mainMenu" class="menu-container">
    <h2 style="color: #ff5722;">夢の道クラス</h2>
    <button class="mainBtn" onclick="showMinnaMenu()">MINNA NO NIHONGO</button>
    <button class="mainBtn iroBtn" onclick="showIrodoriMenu()">IRODORI</button>

    <div class="footer-copyright" style="margin-top: 40px; padding: 20px 0; text-align: center; border-top: 1px solid #222; width: 100%;">
        <p style="font-size: 12px; color: #555; line-height: 1.6; margin: 0;">
            Copyright © 2026<br>
            Pengembang Cahya Ramadhan <br>
            日本語クイズ
        </p>
    </div>
  </div>

  <div id="minnaMenu" class="menu-container">
    <button class="mainBtn" onclick="showBagian(1)">KOTOBA BAGIAN 1 (BAB 1-25)</button>
    <button class="mainBtn" onclick="showBagian(2)">KOTOBA BAGIAN 2 (BAB 26-50)</button>
    <button class="mainBtn" style="background:#333; border:2px solid #ff5722;" onclick="showRefMenu()">KOSAKATA REFERENSI</button>
  </div>

  <div id="irodoriMenu" class="menu-container">
    <h2 style="color:#2196f3;">IRODORI</h2>
    <button class="mainBtn iroBtn" onclick="startIrodoriKanji()">KANJI</button>
  </div>

  <div id="dynamicMenu" class="menu-container">
    <h2 id="dynamicTitle">Pilih Bab</h2>
    <div id="headerGrid"></div>
  </div>

  <div id="wordBox">
    <div id="quizHeader">
        <div id="quizInfo"></div>
        <div id="instruksi"></div>
    </div>
    <div id="kanji"></div>
    <div id="kana"></div>
  </div>
  <div id="comboSection" style="display:none; text-align:center; margin-bottom: 10px;">ЁЯМ│ <span id="flowerCount" style="font-weight:bold; color:#4caf50;">0</span></div>
  <div id="options"></div>

  <div id="resultPage">
    <div class="score-circle" id="finalScore">0%</div>
    <div id="finalDetail" style="margin-bottom:20px; color:#aaa; white-space: pre-line;"></div>
    <button id="nextChunkBtn" class="mainBtn" style="margin-bottom:10px; display:none;">LANJUT KUIS</button>
    <button class="mainBtn" style="background:#555;" onclick="goBack()">KEMBALI KE MENU</button>
  </div>
</div>

<script src="data_minna.js"></script>
<script src="data_referensi.js"></script>
<script src="data_irodori.js"></script>

<script>
  let masterPool = [];
  let currentQuestions = [];
  let currentIndex = 0;
  let correctCount = 0;
  let combo = 0;
  let activeView = 'main';
  let prevView = '';
  let currentLabel = '';

  function hideAll() {
    ['mainMenu','minnaMenu','irodoriMenu','dynamicMenu','wordBox','options','comboSection','resultPage']
    .forEach(id => { document.getElementById(id).style.display = 'none'; });
  }

  function showMainMenu() { hideAll(); document.getElementById('mainMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'none'; activeView = 'main'; }
  function showMinnaMenu() { hideAll(); document.getElementById('minnaMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'minna'; }
  function showIrodoriMenu() { hideAll(); document.getElementById('irodoriMenu').style.display = 'flex'; document.getElementById('backBtn').style.display = 'block'; activeView = 'irodori'; }

  // Fungsi Universal untuk menampilkan daftar Bab 1-50
  function showGridMenu(title, type, start, end) {
    hideAll();
    const menu = document.getElementById('dynamicMenu');
    const grid = document.getElementById('headerGrid');
    document.getElementById('dynamicTitle').innerText = title;
    grid.innerHTML = '';
    menu.style.display = 'flex';
    document.getElementById('backBtn').style.display = 'block';
    activeView = type;

    for(let i=start; i<=end; i++) {
        let b = document.createElement('button');
        b.className = 'babBtn';
        b.innerText = 'Bab ' + i;
        b.onclick = () => {
            if(type === 'ref') startQuiz('Ref Bab '+i, referensiData[i]);
            else startQuiz('Bab '+i, babData[i]);
        };
        grid.appendChild(b);
    }
  }

  function showBagian(n) {
    let start = n === 1 ? 1 : 26;
    let end = n === 1 ? 25 : 50;
    prevView = 'minna';
    showGridMenu("Minna No Nihongo", "bagian_"+n, start, end);
  }

  function showRefMenu() {
    prevView = 'minna';
    showGridMenu("Kosakata Referensi", "ref", 1, 50);
  }

  function startQuiz(label, data) {
    if(!data || data.length === 0) { alert("Data belum tersedia!"); return; }
    currentLabel = label;
    masterPool = [...data].sort(() => Math.random() - 0.5);
    nextChunk();
  }

  function startIrodoriKanji() {
    prevView = 'irodori';
    startQuiz("Kanji Irodori", irodoriKanjiData);
  }

  function nextChunk() {
    currentQuestions = masterPool.splice(0, 10);
    currentIndex = 0;
    correctCount = 0;
    combo = 0;
    hideAll();
    document.getElementById('wordBox').style.display = 'flex'; 
    document.getElementById('options').style.display = 'flex'; 
    document.getElementById('comboSection').style.display = 'block';
    activeView = 'quiz';
    renderQuestion();
  }

  function renderQuestion() {
    if(currentIndex >= currentQuestions.length) { showResult(); return; }
    const q = currentQuestions[currentIndex];
    document.getElementById('quizInfo').innerText = currentLabel;
    document.getElementById('instruksi').innerText = q.instruksi || "Pilih jawaban yang benar";
    document.getElementById('kanji').innerText = q.kanji || "";
    document.getElementById('kana').innerText = q.kana || "";
    
    const optBox = document.getElementById('options'); 
    optBox.innerHTML = '';
    
    [...q.answers].sort(()=>Math.random()-0.5).forEach(txt => {
        let b = document.createElement('button'); 
        b.className = 'optBtn'; 
        b.innerText = txt;
        b.onclick = () => {
            if(txt === q.correct) { 
                b.classList.add('correct'); 
                correctCount++; combo++; 
            } else { 
                b.classList.add('wrong'); combo = 0;
                Array.from(optBox.children).forEach(btn => { if(btn.innerText === q.correct) btn.classList.add('correct'); });
            }
            setTimeout(() => { currentIndex++; renderQuestion(); }, 700);
        };
        optBox.appendChild(b);
    });
    document.getElementById('flowerCount').innerText = combo;
  }

  function showResult() {
    hideAll();
    document.getElementById('resultPage').style.display = 'flex';
    let p = Math.round((correctCount/currentQuestions.length)*100);
    document.getElementById('finalScore').innerText = p + "%";
    document.getElementById('finalDetail').innerText = `${currentLabel}\nSisa soal: ${masterPool.length}`;
    
    const btnLanjut = document.getElementById('nextChunkBtn');
    if (masterPool.length > 0) {
        btnLanjut.style.display = 'block';
        btnLanjut.onclick = nextChunk;
    } else {
        btnLanjut.style.display = 'none';
    }
  }

  function goBack() {
    if (activeView === 'quiz' || activeView === 'result') {
        if(currentLabel.includes("Ref")) showRefMenu();
        else if(currentLabel.includes("Kanji")) showIrodoriMenu();
        else showMinnaMenu();
    } else if (activeView.startsWith('bagian') || activeView === 'ref') {
        showMinnaMenu();
    } else if (activeView === 'minna' || activeView === 'irodori') {
        showMainMenu();
    } else {
        showMainMenu();
    }
  }

  window.onload = showMainMenu;
</script>
</body>
</html>

